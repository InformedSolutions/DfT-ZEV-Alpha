{"version":3,"file":"file-upload.js","mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB,oDAAoD,MAAM;AAChF;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,cAAc,4BAA4B,MAAM;AAChD;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB;AACjB,cAAc;AACd;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL,CAAC,E","sources":["webpack://informed.insight.template/./js/file-upload.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', function () {\n    // Get elements\n    var uploadForm = document.querySelector('.async-upload-form');\n    var uploadSubmit = document.querySelector('.async-upload-submit');\n    var progressBar = document.querySelector('.async-upload-progress');\n    var fileInput = document.querySelector('.async-upload-input');\n\n    function validateFileInput(fileInput) {\n        var errorMessages = [];\n\n        // Get the file\n        var file = fileInput.files[0];\n       \n        // Validate the file\n        if (!file) {\n            errorMessages.push('Please select a file to upload.');\n        }\n\n        // Check the file size\n        if (typeof SIZE_LIMIT !== 'undefined' && file && file.size > SIZE_LIMIT) {\n            errorMessages.push('The file is too large.');\n        }\n\n        // Check the file type\n        if (Array.isArray(VALID_EXTENSIONS) && VALID_EXTENSIONS.length > 0 && file) {\n            var fileExtension = file.name.split('.').at(-1).toLowerCase();\n            if (VALID_EXTENSIONS.indexOf(fileExtension) === -1) {\n                errorMessages.push('The file type is not supported.');\n            }\n        }\n\n        return errorMessages;\n    }\n\n    function drawErrors(errors) {\n        hideErrors();\n        var errorsSummary = document.createElement('div');\n        errorsSummary.setAttribute('aria-labelledby', 'error-summary-title');\n        errorsSummary.setAttribute('role', 'alert');\n        errorsSummary.setAttribute('tabindex', '-1');\n        errorsSummary.classList.add('govuk-error-summary');\n        errorsSummary.innerHTML = `\n            <h2 class='govuk-error-summary__title' id='error-summary-title'>There is a problem</h2>\n            <div class='govuk-error-summary__body'>\n                <ul class='govuk-list govuk-error-summary__list'>\n                    ${errors.map(error => `<li><a href='#UploadedFiles'>${error}</a></li>`).join('')}\n                </ul>\n            </div>\n        `;\n        document.getElementById('main-content').prepend(errorsSummary);\n\n        document.querySelector('.govuk-form-group').classList.add('govuk-form-group--error');\n\n        var inputErrors = document.createElement('span');\n        inputErrors.classList.add('govuk-error-message');\n        inputErrors.innerHTML = `\n            <span class='govuk-visually-hidden'>Error</span>\n            ${errors.map(error => `<div>${error}</div>`).join('')}\n        `;\n        document.querySelector('.govuk-form-group .govuk-file-upload').insertAdjacentElement('beforebegin', inputErrors);\n\n        document.querySelector('.govuk-file-upload').classList.add('govuk-file-upload--error');\n\n        uploadSubmit.disabled = true;\n    }\n\n    function hideErrors() {\n        var errorSummary = document.querySelector('.govuk-error-summary');\n        if (errorSummary) {\n            errorSummary.remove();\n        }\n\n        var formGroup = document.querySelector('.govuk-form-group');\n        if (formGroup) {\n            formGroup.classList.remove('govuk-form-group--error');\n        }\n\n        var errorMessage = document.querySelector('.govuk-form-group .govuk-error-message');\n        if (errorMessage) {\n            errorMessage.remove();\n        }\n\n        var fileUpload = document.querySelector('.govuk-file-upload');\n        if (fileUpload) {\n            fileUpload.classList.remove('govuk-file-upload--error');\n        }\n\n        uploadSubmit.disabled = false;\n    }\n\n    fileInput.addEventListener('change', function () {\n        hideErrors();\n        var errorMessages = validateFileInput(fileInput);\n        if(errorMessages.length > 0){\n            drawErrors(errorMessages);\n            return;\n        }\n    });\n\n    uploadSubmit.addEventListener('click', function (e) {\n        e.preventDefault();\n\n        // Disable the submit button\n        uploadSubmit.disabled = true;\n       \n\n        // Create a new FormData object\n        var formData = new FormData(uploadForm);\n\n        // Show the progress bar\n        progressBar.style.display = 'block';\n\n        // Create a new XMLHttpRequest\n        var xhr = new XMLHttpRequest();\n\n        // Track upload progress\n        xhr.upload.addEventListener('progress', function (event) {\n            if (event.lengthComputable) {\n                var percentComplete = (event.loaded / event.total) * 100;\n                percentComplete = Math.min(percentComplete, 90);\n                progressBar.value = percentComplete;\n            }\n        });\n\n        // Handle successful upload\n        xhr.onload = function () {\n            if (xhr.status === 200) {\n                progressBar.value = 100;\n\n                setTimeout(function () {\n                    window.location.href = '/Data/upload-success';\n                }, 200);\n            } else {\n                // Enable the submit button if the upload failed\n                uploadSubmit.disabled = false;\n            }\n        };\n\n        // Handle errors\n        xhr.onerror = function () {\n            console.error('Error during upload');\n            // Enable the submit button if an error occurred\n            uploadSubmit.disabled = false;\n        };\n\n        // Send the request\n        xhr.open('POST', '/data/upload-file', true);\n        xhr.send(formData);\n    });\n});"],"names":[],"sourceRoot":""}